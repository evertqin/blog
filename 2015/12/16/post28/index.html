<!doctype html>




<html class="theme-next mist" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/blog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/blog/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Technology,Javascript,ReactJS,Flux," />





  <link rel="alternate" href="/blog/atom.xml" title="while(1);" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/blog/favicon.ico?v=5.1.1" />






<meta name="description" content="Consider the following scenario, we are creating a set of dropdowns each displays a series folders in a file system. User will click a dropdown to view all the folders (or files), then make a selectio">
<meta name="keywords" content="Technology,Javascript,ReactJS,Flux">
<meta property="og:type" content="article">
<meta property="og:title" content="Making a Ajax file structure browser with ReactJs Flux Pattern">
<meta property="og:url" content="https://evertqin.github.io/blog/2015/12/16/post28/index.html">
<meta property="og:site_name" content="while(1);">
<meta property="og:description" content="Consider the following scenario, we are creating a set of dropdowns each displays a series folders in a file system. User will click a dropdown to view all the folders (or files), then make a selectio">
<meta property="og:image" content="http://i.imgur.com/rMInLfF.jpg=242x455">
<meta property="og:image" content="http://i.imgur.com/vmev9q0.png">
<meta property="og:image" content="http://i.imgur.com/iYVvuxh.gif">
<meta property="og:updated_time" content="2017-08-10T18:20:15.856Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Making a Ajax file structure browser with ReactJs Flux Pattern">
<meta name="twitter:description" content="Consider the following scenario, we are creating a set of dropdowns each displays a series folders in a file system. User will click a dropdown to view all the folders (or files), then make a selectio">
<meta name="twitter:image" content="http://i.imgur.com/rMInLfF.jpg=242x455">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://evertqin.github.io/blog/2015/12/16/post28/"/>





  <title>Making a Ajax file structure browser with ReactJs Flux Pattern | while(1);</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/blog/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">while(1);</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">A dumpster of everything</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/blog/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blog/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-instagram">
          <a href="https://www.instagram.com/evertqin/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            instagram
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://evertqin.github.io/blog/blog/2015/12/16/post28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="R Qin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="while(1);">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Making a Ajax file structure browser with ReactJs Flux Pattern</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-12-16T00:00:00-05:00">
                2015-12-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2015/12/16/post28/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/12/16/post28/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Consider the following scenario, we are creating a set of dropdowns each displays a series folders in a file system. User will click a dropdown to view all the folders (or files), then make a selection. After selection is made, all the dropdowns following the one user interacted with will change to show the subfolders (or files, if there are any) in the folder the user has selected.</p>
<a id="more"></a>
<p>An apparent solution to that scenario is by using an cascading event structure. The figure below demonstrate this simple structure:</p>
<p><img src="http://i.imgur.com/rMInLfF.jpg=242x455" alt="Demo"></p>
<p>From the figure, we can see a change event from the controls higher in the hierarchy triggers data change in the control lower in the hierarchy, which will then triggers the change of its lower hierarchical controls. This process will continue until there is no more downstream controls. There are nothing wrong with this approach, since it is very straightforward and simple. We essentially chain a unidirectional events together.</p>
<p>Does “unidirectional” ring a bell? Yes, we keep this word in heart when we are practicing <a href="https://facebook.github.io/flux/docs/overview.html" target="_blank" rel="external">Flux Pattern</a>. The different is, in flux, it emchews a MVC pattern, ReactJS views are actually view-controllers whose responsiblities include retrieving data from stores and propagate them to children. Actions are usually user interactions with the views and they are propagated to the dispatchers who execute callbacks registered to that action to interact with corresponding store(s).</p>
<p>My initial reaction is: we can use Flux pattern to create this structure, we can fit our scenario perfectly into Flux pattern. The following figures shows the modified Flux structure.</p>
<p><img src="http://i.imgur.com/vmev9q0.png" alt="Modified Flux"></p>
<p>Data flow is no different from the standard Flux. My change is: instead of creating separate store and view from different options, the stores can be derived from a single base store. If we are storing data of similar format, we event don’t need to create separate store, we can just use the base store directly. </p>
<p>The views are derived from a single base view, and to achieve the chaining, instead of binding event listeners, we do this by class inheritance. For example, view0 has a method _onChange which does some ajax requests to fetch fresh data. View1 will inherit everything from view0 (which has everything already setup), and bind its own event handler to the events emitter of view0, such as <code>var BaseComponent = require(&#39;./AppComponent1&#39;);</code>(You will see this in <a href="#create-reactjs-components">Create ReactJs Components</a>)</p>
<p>First everything I am doing here can be found on my GitHub (<a href="https://github.com/evertqin/flux-reactjs-chain-reactions" target="_blank" rel="external">https://github.com/evertqin/flux-reactjs-chain-reactions</a>). To run the demo, checkout everything then run</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install</div></pre></td></tr></table></figure>
<p>then<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm start</div></pre></td></tr></table></figure></p>
<p>then navigate to <code>http://localhost:3000</code> to see the result.</p>
<p>To start from scratch, make sure you have nodejs installed, for demo purpose, I am using express to generate web scaffold, feel free to choose other types of frameworks as long as it is able to provide endpoints that is capable of returning JSON.</p>
<h1 id="Setup-backend-services"><a href="#Setup-backend-services" class="headerlink" title="Setup backend services"></a>Setup backend services</h1><h4 id="Install-Express-and-scaffoldding-the-web-application"><a href="#Install-Express-and-scaffoldding-the-web-application" class="headerlink" title="Install Express and scaffoldding the web application."></a>Install Express and scaffoldding the web application.</h4><p>First make sure express generator is installed:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo npm install express-generator -g</div></pre></td></tr></table></figure>
<p>Then type</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">express myapp</div></pre></td></tr></table></figure>
<p>Replace “myapp” with the the name of your app.</p>
<p>You also need to add some dependencies to <code>package.json</code> besides those added by express. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"> &quot;name&quot;: &quot;nodejs-react-flux&quot;,</div><div class="line"> &quot;version&quot;: &quot;0.0.0&quot;,</div><div class="line"> &quot;private&quot;: true,</div><div class="line"> &quot;scripts&quot;: &#123;</div><div class="line">  &quot;start&quot;: &quot;node ./bin/www&quot;,</div><div class="line">  &quot;build&quot;: &quot;grunt&quot;,</div><div class="line">  &quot;test&quot;: &quot;jest&quot;</div><div class="line"> &#125;,</div><div class="line"> &quot;dependencies&quot;: &#123;</div><div class="line">  &quot;body-parser&quot;: &quot;~1.13.2&quot;,</div><div class="line">  &quot;cookie-parser&quot;: &quot;~1.3.5&quot;,</div><div class="line">  &quot;debug&quot;: &quot;~2.2.0&quot;,</div><div class="line">  &quot;express&quot;: &quot;~4.13.1&quot;,</div><div class="line">  &quot;jade&quot;: &quot;~1.11.0&quot;,</div><div class="line">  &quot;morgan&quot;: &quot;~1.6.1&quot;,</div><div class="line">  &quot;serve-favicon&quot;: &quot;~2.3.0&quot;,</div><div class="line">  &quot;flux&quot;: &quot;^2.1.1&quot;,</div><div class="line">  &quot;grunt&quot;: &quot;^0.4.5&quot;,</div><div class="line">  &quot;jquery&quot;: &quot;^2.1.4&quot;,</div><div class="line">  &quot;keymirror&quot;: &quot;^0.1.1&quot;,</div><div class="line">  &quot;object-assign&quot;: &quot;^4.0.1&quot;,</div><div class="line">  &quot;object-is&quot;: &quot;^1.0.1&quot;</div><div class="line"> &#125;,</div><div class="line"> &quot;devDependencies&quot;: &#123;</div><div class="line">  &quot;babel-preset-es2015&quot;: &quot;^6.3.13&quot;,</div><div class="line">  &quot;babel-preset-react&quot;: &quot;^6.1.18&quot;,</div><div class="line">  &quot;babelify&quot;: &quot;^7.2.0&quot;,</div><div class="line">  &quot;browserify&quot;: &quot;^12.0.1&quot;,</div><div class="line">  &quot;grunt-browserify&quot;: &quot;^4.0.1&quot;,</div><div class="line">  &quot;grunt-contrib-sass&quot;: &quot;^0.9.2&quot;,</div><div class="line">  &quot;grunt-contrib-watch&quot;: &quot;^0.6.1&quot;,</div><div class="line">  &quot;grunt-react&quot;: &quot;^0.12.3&quot;,</div><div class="line">  &quot;jest-cli&quot;: &quot;^0.8.2&quot;,</div><div class="line">  &quot;babel-jest&quot;: &quot;*&quot;,</div><div class="line">  &quot;react&quot;: &quot;^0.14.3&quot;,</div><div class="line">  &quot;react-dom&quot;: &quot;^0.14.3&quot;</div><div class="line"> &#125;,</div><div class="line"> &quot;jest&quot;: &#123;</div><div class="line">  &quot;modulePathIgnorePatterns&quot;: [</div><div class="line">   &quot;/node_modules/&quot;</div><div class="line">  ],</div><div class="line">  &quot;rootDir&quot;: &quot;&quot;,</div><div class="line">  &quot;scriptPreprocessor&quot;: &quot;&lt;rootDir&gt;/node_modules/babel-jest&quot;,</div><div class="line">  &quot;testFileExtensions&quot;: [&quot;es6&quot;, &quot;js&quot;],</div><div class="line">  &quot;moduleFileExtensions&quot;: [&quot;jsx&quot;,&quot;js&quot;, &quot;json&quot;, &quot;es6&quot;],</div><div class="line">   &quot;testPathDirs&quot;: [</div><div class="line">   &quot;&lt;rootDir&gt;/public/js&quot;</div><div class="line">  ],</div><div class="line">  &quot;unmockedModulePathPatterns&quot;: [</div><div class="line">   &quot;&lt;rootDir&gt;/node_modules/react&quot;,</div><div class="line">   &quot;&lt;rootDir&gt;/node_modules/react-dom&quot;,</div><div class="line">   &quot;&lt;rootDir&gt;/node_modules/react-addons-test-utils&quot;,</div><div class="line">   &quot;&lt;rootDir&gt;/node_modules/fbjs&quot;</div><div class="line">  ]</div><div class="line"> &#125;,</div><div class="line"> &quot;author&quot;: &quot;Ruogu Qin&quot;,</div><div class="line"> &quot;license&quot;: &quot;MIT&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The file can also be found on my GitHub (<a href="https://github.com/evertqin/flux-reactjs-chain-reactions/blob/master/package.json" target="_blank" rel="external">https://github.com/evertqin/flux-reactjs-chain-reactions/blob/master/package.json</a>).</p>
<p>After adding necessary dependencies, run <code>npm install</code>.</p>
<h4 id="Setup-grunt-for-automation"><a href="#Setup-grunt-for-automation" class="headerlink" title="Setup grunt for automation."></a>Setup grunt for automation.</h4><p>I used browserify to compile js/jsx/es6 files, I also used jest(which is the default testing framework provided in official flux example)</p>
<p>Install grunt by typing:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo npm install grunt-cli -g</div></pre></td></tr></table></figure>
<p>Modify the <code>gruntfile.js</code> according to <a href="https://github.com/evertqin/flux-reactjs-chain-reactions/blob/master/gruntfile.js" target="_blank" rel="external">https://github.com/evertqin/flux-reactjs-chain-reactions/blob/master/gruntfile.js</a>, </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">This file in the main entry point for defining grunt tasks and using grunt plugins.</div><div class="line">Click here to learn more. http://go.microsoft.com/fwlink/?LinkID=513275&amp;clcid=0x409</div><div class="line">*/</div><div class="line">module.exports = function(grunt) &#123;</div><div class="line">  grunt.initConfig(&#123;</div><div class="line">  pkg: grunt.file.readJSON(&apos;package.json&apos;),</div><div class="line">  </div><div class="line">  browserify: &#123;</div><div class="line">   dist: &#123;</div><div class="line">       options: &#123;</div><div class="line">          transform: [</div><div class="line">            [&quot;babelify&quot;, &#123;</div><div class="line">              presets: [&quot;react&quot;, &quot;es2015&quot;]</div><div class="line">            &#125;]</div><div class="line">          ],</div><div class="line">          noParse: [&quot;~/node_modules/jquery/**/*&quot;, &quot;~/node_modules/react/**/*&quot;, &quot;~/node_modules/react-dom/**/*&quot;],</div><div class="line">          browserifyOptions: &#123;</div><div class="line">            debug: true</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        files: &#123;</div><div class="line">          &quot;public/build/js/app-bundle.js&quot;: [&quot;public/js/app.jsx&quot;]</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    sass: &#123;</div><div class="line">      dynamic_mapping: &#123;</div><div class="line">        files: [&#123;</div><div class="line">          expand: true,</div><div class="line">          cwd: &apos;public/stylesheets&apos;,</div><div class="line">          src: [&apos;*.scss&apos;],</div><div class="line">          dest: &apos;public/build/stylesheets&apos;,</div><div class="line">          ext: &apos;.css&apos;,</div><div class="line">        &#125;]</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    watch: &#123;</div><div class="line">      js: &#123;</div><div class="line">        files: [&quot;public/js/**/*.jsx&quot;, &quot;public/js/**/*.js&quot;, &quot;!public/build/**/*&quot;, &quot;!public/js/**/__tests__/*&quot;],</div><div class="line">        tasks: [&quot;browserify&quot;]</div><div class="line">      &#125;,</div><div class="line">      css: &#123;</div><div class="line">        files:[&quot;public/stylesheets/**/*.scss&quot;],</div><div class="line">        tasks: [&quot;sass&quot;]</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  grunt.registerTask(&apos;default&apos;, [&apos;watch&apos;]);</div><div class="line">  grunt.registerTask(&apos;build&apos;, [&apos;browserify&apos;, &apos;sass&apos;]);</div><div class="line">  grunt.loadNpmTasks(&apos;grunt-contrib-sass&apos;);</div><div class="line">  grunt.loadNpmTasks(&apos;grunt-browserify&apos;);</div><div class="line">  grunt.loadNpmTasks(&apos;grunt-contrib-watch&apos;);</div><div class="line"></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>the default task is registed as watch, you can build your browserify bundle by typing <code>grunt build</code>.</p>
<h4 id="Add-routes"><a href="#Add-routes" class="headerlink" title="Add routes"></a>Add routes</h4><p>I add three endpoints to the express router. Because I want to demonstrate populating three dropdowns, so each of these endpoints returns an array in JSON format. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">var express = require(&apos;express&apos;);</div><div class="line">var url = require(&apos;url&apos;);</div><div class="line">var querystring = require(&apos;querystring&apos;);</div><div class="line">var fs = require(&apos;fs&apos;);</div><div class="line">var path = require(&apos;path&apos;);</div><div class="line">var router = express.Router();</div><div class="line">var HOME = process.env[(process.platform == &apos;win32&apos;) ? &apos;USERPROFILE&apos; : &apos;HOME&apos;];</div><div class="line"></div><div class="line">/* GET home page. */</div><div class="line"></div><div class="line">router.get(&apos;/&apos;, function(req, res) &#123;</div><div class="line"> res.render(&apos;index&apos;, &#123;</div><div class="line">  title: &apos;Express&apos;</div><div class="line"> &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">router.get(&apos;/Analysis/root&apos;, function(req, res, next) &#123;</div><div class="line"> fs.readdir(HOME, function(err, files) &#123;</div><div class="line">  if (err) &#123;</div><div class="line">   res.send([]);</div><div class="line">   return;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if (files) &#123;</div><div class="line">   files = files.filter(function(item) &#123;</div><div class="line">    return fs.lstatSync(path.join(HOME, item)).isDirectory();</div><div class="line">   &#125;);</div><div class="line">   res.send(files);</div><div class="line">  &#125; else &#123;</div><div class="line">   res.send([]);</div><div class="line">  &#125;</div><div class="line"> &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">router.get(&apos;/Analysis/level0&apos;, function(req, res, next) &#123;</div><div class="line"> var selected = req.query.root;</div><div class="line"> fs.readdir(path.join(HOME, selected), function(err, files) &#123;</div><div class="line">  if (err) &#123;</div><div class="line">   res.send([]);</div><div class="line">   return;</div><div class="line">  &#125;</div><div class="line">  if (files) &#123;</div><div class="line">   files = files.filter(function(item) &#123;</div><div class="line">    return fs.lstatSync(path.join(HOME, selected, item)).isDirectory();</div><div class="line">   &#125;);</div><div class="line">   res.send(files);</div><div class="line">  &#125; else &#123;</div><div class="line">   res.send([]);</div><div class="line">  &#125;</div><div class="line"> &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">router.get(&apos;/Analysis/level1&apos;, function(req, res, next) &#123;</div><div class="line"> var root = req.query.root;</div><div class="line"> var level0 = req.query.level0;</div><div class="line"></div><div class="line"> fs.readdir(path.join(HOME, root, level0), function(err, files) &#123;</div><div class="line">  if (err) &#123;</div><div class="line">   res.send([]);</div><div class="line">  &#125; else &#123;</div><div class="line">   res.send(files);</div><div class="line">  &#125;</div><div class="line"> &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">module.exports = router;</div></pre></td></tr></table></figure>
<p>Please check the file on GitHub (<a href="https://github.com/evertqin/flux-reactjs-chain-reactions/blob/master/routes/index.js" target="_blank" rel="external">https://github.com/evertqin/flux-reactjs-chain-reactions/blob/master/routes/index.js</a>).</p>
<p>Now we have created all the backend services we need, we can try to test it here. Navigate to the root directory of “myapp” then type <code>npm start</code>. It everything is correct, you should see Express Hello world page.</p>
<h1 id="Setup-flux-and-reactjs"><a href="#Setup-flux-and-reactjs" class="headerlink" title="Setup flux and reactjs"></a>Setup flux and reactjs</h1><p>Next, we are moving to creating frontend code. It is important to setup folder structures for your ReactJs and flux application, the resultant directory tree should be more or less like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">myapp</div><div class="line">|-actions</div><div class="line">|-components</div><div class="line">|-configs</div><div class="line">|-constants</div><div class="line">|-dispatcher</div><div class="line">|-stores</div><div class="line">|-utils</div></pre></td></tr></table></figure>
<h2 id="Setup-dispatcher"><a href="#Setup-dispatcher" class="headerlink" title="Setup dispatcher"></a>Setup dispatcher</h2><p>Since we are not making any customize modification for now, I using the default dispatcher.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var Dispatcher = require(&apos;flux&apos;).Dispatcher;</div><div class="line">module.exports = new Dispatcher();</div></pre></td></tr></table></figure>
<p><a href="https://facebook.github.io/flux/docs/todo-list.html#creating-a-dispatcher" target="_blank" rel="external">Flux ToDo List Tutorial</a> gives more detailed insight about the dispatcher.</p>
<h2 id="Create-Actions"><a href="#Create-Actions" class="headerlink" title="Create Actions"></a>Create Actions</h2><p>Depends on the type of the actions, the approperate dispatcher is called to trigger the invocation of a registered callback. I generalize this part assuming our application is doing one thing, getting an action type, wait for all the upstream actions to finish, then broadcast this action as event.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">var AppDispatcher = require(&apos;../dispatcher/AppDispatcher&apos;);</div><div class="line">var Constants = require(&apos;../constants/constants&apos;);</div><div class="line">var ActionTypes = require(&apos;./Actions&apos;);</div><div class="line"></div><div class="line">var Actions = &#123;</div><div class="line">	excute: function(actionType, value) &#123;</div><div class="line">		AppDispatcher.dispatch(&#123;</div><div class="line">			actionType: actionType,</div><div class="line">			value: value,</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">module.exports = Actions;</div></pre></td></tr></table></figure>
<h2 id="Setup-stores"><a href="#Setup-stores" class="headerlink" title="Setup stores"></a>Setup stores</h2><p>Instead of creating one store for each of the component (which is how the official tutorial do it). I am generalizing stores and use a store manager to manage data and events for all the stores. A store config file is used to tell the store manager what stores will be initialized and how they are initialized.</p>
<p>The following <code>Config.js</code> is located under configs folder<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;;</div><div class="line">var Config = [&#123;</div><div class="line">	name: &apos;AppComponent0&apos;,</div><div class="line">	class: require(&apos;../stores/Store&apos;),</div><div class="line">&#125;, &#123;</div><div class="line">	name: &apos;AppComponent1&apos;,</div><div class="line">	class: require(&apos;../stores/Store&apos;),</div><div class="line">&#125;,&#123;</div><div class="line">	name: &apos;AppComponent2&apos;,</div><div class="line">	class: require(&apos;../stores/Store&apos;),</div><div class="line">&#125; ];</div><div class="line"></div><div class="line">module.exports = Config;</div></pre></td></tr></table></figure></p>
<p>Storemanager will read the above file and populate an array of store object:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line">&quot;use strict&quot;;</div><div class="line"></div><div class="line">var AppDispatcher = require(&apos;../dispatcher/AppDispatcher&apos;);</div><div class="line">var storesConfig = require(&apos;../configs/Config&apos;);</div><div class="line"></div><div class="line">class StoresManager &#123;</div><div class="line">	constructor() &#123;</div><div class="line">		this._stores = &#123;&#125;;</div><div class="line">		this._order = [];</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	add(store) &#123;</div><div class="line">		if (!!store) &#123;</div><div class="line">			if (!(store in this._stores)) &#123;</div><div class="line">				this._stores[store.name] = store;</div><div class="line">				this._order.push(store);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		// we need to handle all the previous stores</div><div class="line">		store.dispatchToken = AppDispatcher.register(function(payload) &#123;</div><div class="line">			var index = -1;</div><div class="line">			for(var i = 0; i &lt; this._order.length; ++i)&#123;</div><div class="line">				if(this._order[i].name === payload.actionType)&#123;</div><div class="line">					index = i;</div><div class="line">					break;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			var storeIndex = this._order.indexOf(store);</div><div class="line"></div><div class="line">			if(index &gt; storeIndex)&#123;</div><div class="line">				// higher hirachy actions will not cause any change in the lower </div><div class="line">				// hirachy stores</div><div class="line">				return;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			var pre = this._order.slice(0, index);</div><div class="line"></div><div class="line">			AppDispatcher.waitFor(pre.map(s=&gt;&#123;return s.dispatchToken;&#125;));</div><div class="line">			store.dispatch(payload);	</div><div class="line">			store.emitChange();</div><div class="line">		&#125;.bind(this));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	remove(store) &#123;</div><div class="line">		var index = this._order.indexOf(store.name);</div><div class="line"></div><div class="line">		if (index &gt; -1) &#123;</div><div class="line">			this._stores.splice(index, 1);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		if (store.name in this._stores) &#123;</div><div class="line">			delete this._stores[store.name];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	get allStores() &#123;</div><div class="line">		return this._order;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	getStoreState(name) &#123;</div><div class="line">		return this._stores[name].state;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	addListener(name, callback) &#123;</div><div class="line">		var store = this._stores[name];</div><div class="line"></div><div class="line">		if(store)&#123;</div><div class="line">			store.addChangeListener(callback);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	removeListener(name, callback)&#123;</div><div class="line">		var store = this._stores[name];</div><div class="line"></div><div class="line">		if(store)&#123;</div><div class="line">			store.removeChangeListener(callback);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	printAllStores() &#123;</div><div class="line">		console.log(this._stores);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	static init() &#123;</div><div class="line">		var storesManager = new StoresManager();</div><div class="line"></div><div class="line">		for(var i = 0; i &lt; storesConfig.length; ++i)&#123;</div><div class="line">			var store = new storesConfig[i].class(storesConfig[i].name);</div><div class="line">			storesManager.add(store);</div><div class="line">		&#125;</div><div class="line">		return storesManager;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">module.exports = StoresManager.init();</div></pre></td></tr></table></figure>
<p>Stores are added to the manager by the order they are specified in the config file and this order reflects the dependency among dropdowns. So in this case, AppComponent2 will depend on AppComponent1 which depends on AppComponent0. These stores are added to the manager in such as way that when a new store is added to the end of this hierarchy, it will register itself to the dispatcher and waitFor all the upstream stores to finish their excusion.</p>
<p>Single stores generally follow the same pattern, I created a generic <code>Store</code> class. Specific stores can be created by subclassing this one or by their own.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;;</div><div class="line"></div><div class="line">var EventEmitter = require(&apos;events&apos;).EventEmitter;</div><div class="line"></div><div class="line">class Store extends EventEmitter &#123;</div><div class="line">	constructor(name) &#123;</div><div class="line">		super();</div><div class="line"></div><div class="line">		if (!name) &#123;</div><div class="line">			throw new TypeError(&apos;You must provide the name of the store&apos;);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		this.name = name ? name : &apos;Store&apos;;</div><div class="line">		this.state = &#123;</div><div class="line">			list: [&apos;Universal&apos;],</div><div class="line">      selected: &apos;Universal&apos;</div><div class="line">		&#125;;</div><div class="line">		this.dispatchToken = &#123;&#125;;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	update(value)&#123;</div><div class="line">		console.log(&quot;Updating &quot; + value);</div><div class="line">		for(let tag in value)&#123;</div><div class="line">			if(value.hasOwnProperty(tag))&#123;</div><div class="line">				this.state[tag] = value[tag];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	dispatch(action) &#123;</div><div class="line">		console.log(&quot;Dispatching \&quot;&quot; + this.name + &quot;\&quot;.&quot; );</div><div class="line">		if(!Object.is(action.value, this.state)) &#123;</div><div class="line">			this.update(action.value);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	emitChange() &#123;</div><div class="line">		console.log(&quot;Emitting &quot; + this.name);</div><div class="line">		super.emit(this.name);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	addChangeListener(callback) &#123;</div><div class="line">		super.on(this.name, callback);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	removeChangeListener(callback) &#123;</div><div class="line">		super.removeListener(this.name, callback);</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">module.exports = Store;</div></pre></td></tr></table></figure>
<h2 id="Create-ReactJs-Components"><a href="#Create-ReactJs-Components" class="headerlink" title="Create ReactJs Components"></a><a name="create-reactjs-components"></a>Create ReactJs Components</h2><p>This is the key part, to get the application running, we need to create ReactJs UI component. We start with a base component.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;;</div><div class="line"></div><div class="line">var React = require(&apos;react&apos;);</div><div class="line">var StoresManager = require(&apos;../stores/StoresManager&apos;);</div><div class="line">var Actions = require(&apos;../actions/Actions&apos;);</div><div class="line">var UserControls = require(&apos;./UserControls.jsx&apos;);</div><div class="line">var utils = require(&apos;../utils/AjaxUtils&apos;);</div><div class="line"></div><div class="line">var ajaxGet = utils.ajaxGet;</div><div class="line"></div><div class="line">class BaseComponent extends React.Component &#123;</div><div class="line">	constructor(props) &#123;</div><div class="line">		super(props);</div><div class="line">		this.state = StoresManager.getStoreState(props.name);</div><div class="line">		// we need to manually bind this to custom methods</div><div class="line">		//https://github.com/goatslacker/alt/issues/283</div><div class="line">		this._onChange = this._onChange.bind(this);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	componentDidMount() &#123;</div><div class="line">		console.log(&quot;calling base componentDidMount&quot;);</div><div class="line">		ajaxGet.call(this, this.props.url, &#123;&#125;).then(this._onChange);</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	componentWillUnmount() &#123;</div><div class="line">		// AnalysisInputStores.removeChangeListener(this._onChange);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	_onChange(value) &#123;</div><div class="line">		Actions.excute(this.props.name, value);</div><div class="line">		this.setState(StoresManager.getStoreState(this.props.name));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	render() &#123;</div><div class="line">		return React.createElement(UserControls.AnalysisDropDown, &#123;</div><div class="line">			dataSource: this.state.list,</div><div class="line">			selected: this.state.selected,</div><div class="line">			selectChange: this._onChange</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">BaseComponent.propTypes = &#123;</div><div class="line">	name: React.PropTypes.string.isRequired,</div><div class="line">	url: React.PropTypes.string.isRequired</div><div class="line">&#125;;</div><div class="line"></div><div class="line">BaseComponent.defaultProps = &#123;</div><div class="line">	name: &apos;BaseComponent&apos;, // change this</div><div class="line">	url: &apos;/Analysis/root&apos;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">module.exports = BaseComponent;</div></pre></td></tr></table></figure>
<p>The initial data is populated by doing an ajax request to the backend. Then the _onChange event is triggered so the internal state of this component and that stored in its corresponding store are synced.</p>
<p>For the rest of the components, we just need to subclass its predecessors (which is the component lower in the hierarchy), and provide a customized event handler as shown below:</p>
<p>For example, for the first component (<code>AppComponent0</code>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;;</div><div class="line"></div><div class="line">var React = require(&apos;react&apos;);</div><div class="line">var StoresManager = require(&apos;../stores/StoresManager&apos;);</div><div class="line">var Actions = require(&apos;../actions/Actions&apos;);</div><div class="line">var UserControls = require(&apos;./UserControls.jsx&apos;);</div><div class="line">var BaseComponent = require(&apos;./BaseComponent&apos;);</div><div class="line">var utils = require(&apos;../utils/AjaxUtils&apos;);</div><div class="line"></div><div class="line">var ajaxGet = utils.ajaxGet;</div><div class="line"></div><div class="line">class AppComponent0 extends BaseComponent &#123;</div><div class="line">	constructor(props) &#123;</div><div class="line">		super(props);</div><div class="line">		this.state = StoresManager.getStoreState(props.name);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	render() &#123;</div><div class="line">		return React.createElement(UserControls.AnalysisDropDown, &#123;</div><div class="line">			dataSource: this.state.list,</div><div class="line">			selected: this.state.selected,</div><div class="line">			selectChange: this._onChange</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">AppComponent0.propTypes = &#123;</div><div class="line">	name: React.PropTypes.string.isRequired,</div><div class="line">	url: React.PropTypes.string.isRequired</div><div class="line">&#125;;</div><div class="line"></div><div class="line">AppComponent0.defaultProps = &#123;</div><div class="line">	name: &apos;AppComponent0&apos;, // change this</div><div class="line">	url: &apos;/Analysis/root&apos;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">module.exports = AppComponent0;</div></pre></td></tr></table></figure>
<p>for the second component (<code>AppComponent1</code>):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;;</div><div class="line"></div><div class="line">var React = require(&apos;react&apos;);</div><div class="line">var StoresManager = require(&apos;../stores/StoresManager&apos;);</div><div class="line">var Actions = require(&apos;../actions/Actions&apos;);</div><div class="line">var UserControls = require(&apos;./UserControls.jsx&apos;);</div><div class="line">var BaseComponent = require(&apos;./AppComponent0&apos;);</div><div class="line">var utils = require(&apos;../utils/AjaxUtils&apos;);</div><div class="line"></div><div class="line">var ajaxGet = utils.ajaxGet;</div><div class="line"></div><div class="line">class AppComponent1 extends BaseComponent &#123;</div><div class="line">	constructor(props) &#123;</div><div class="line">		super(props);</div><div class="line">		this.state = StoresManager.getStoreState(props.name);</div><div class="line">		// we need to manually bind this to custom methods</div><div class="line">		//https://github.com/goatslacker/alt/issues/283</div><div class="line">		this._onRootChange = this._onRootChange.bind(this);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	componentDidMount() &#123;</div><div class="line">		//Here should attach event listener to upstream store</div><div class="line">		StoresManager.addListener(BaseComponent.name, this._onRootChange);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	componentWillUnmount() &#123;</div><div class="line">		StoresManager.removeListener(BaseComponent.name, this._onRootChange);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	_onRootChange() &#123;</div><div class="line">		ajaxGet.call(this, this.props.url, &#123;</div><div class="line">			root: StoresManager.getStoreState(BaseComponent.name).selected</div><div class="line">		&#125;).then(this._onChange);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	render() &#123;</div><div class="line">		return React.createElement(UserControls.AnalysisDropDown, &#123;</div><div class="line">			dataSource: this.state.list,</div><div class="line">			selected: this.state.selected,</div><div class="line">			selectChange: this._onChange</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">AppComponent1.propTypes = &#123;</div><div class="line">	name: React.PropTypes.string.isRequired,</div><div class="line">	root: React.PropTypes.string.isRequired,</div><div class="line">	url: React.PropTypes.string.isRequired</div><div class="line">&#125;;</div><div class="line"></div><div class="line">AppComponent1.defaultProps = &#123;</div><div class="line">	name: &apos;AppComponent1&apos;, // change this</div><div class="line">	root: &apos;.android&apos;,</div><div class="line">	url: &apos;/Analysis/level0&apos;,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">module.exports = AppComponent1;</div></pre></td></tr></table></figure></p>
<p>And et cetera… to create more component in the chain, just inherit, add own event handler then register the event handler to lower hierarchical control’s event emitter, and that’s it!</p>
<p>Refer to <a href="https://github.com/evertqin/flux-reactjs-chain-reactions/tree/master/public/js/components" target="_blank" rel="external">https://github.com/evertqin/flux-reactjs-chain-reactions/tree/master/public/js/components</a> for other components necessary for creating this application.</p>
<p>Finally, compile the js with <code>npm build</code>, then you can check the result with <a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a></p>
<p>The result should look like this:</p>
<p><img src="http://i.imgur.com/iYVvuxh.gif" alt="Display Grid"></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/blog/tags/Technology/" rel="tag"># Technology</a>
          
            <a href="/blog/tags/Javascript/" rel="tag"># Javascript</a>
          
            <a href="/blog/tags/ReactJS/" rel="tag"># ReactJS</a>
          
            <a href="/blog/tags/Flux/" rel="tag"># Flux</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/2015/11/24/post27/" rel="next" title="How to setup ReactJS dev enviornment with Browserify, Babel and grunt">
                <i class="fa fa-chevron-left"></i> How to setup ReactJS dev enviornment with Browserify, Babel and grunt
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/2016/01/01/post29/" rel="prev" title="2015 年终总结">
                2015 年终总结 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/blog/images/avatar.gif"
               alt="R Qin" />
          <p class="site-author-name" itemprop="name">R Qin</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/blog/archives/">
                <span class="site-state-item-count">34</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/blog/tags/index.html">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/blog/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Setup-backend-services"><span class="nav-number">1.</span> <span class="nav-text">Setup backend services</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Install-Express-and-scaffoldding-the-web-application"><span class="nav-number">1.0.0.1.</span> <span class="nav-text">Install Express and scaffoldding the web application.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Setup-grunt-for-automation"><span class="nav-number">1.0.0.2.</span> <span class="nav-text">Setup grunt for automation.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Add-routes"><span class="nav-number">1.0.0.3.</span> <span class="nav-text">Add routes</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Setup-flux-and-reactjs"><span class="nav-number">2.</span> <span class="nav-text">Setup flux and reactjs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Setup-dispatcher"><span class="nav-number">2.1.</span> <span class="nav-text">Setup dispatcher</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-Actions"><span class="nav-number">2.2.</span> <span class="nav-text">Create Actions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Setup-stores"><span class="nav-number">2.3.</span> <span class="nav-text">Setup stores</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-ReactJs-Components"><span class="nav-number">2.4.</span> <span class="nav-text">Create ReactJs Components</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">R Qin</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/blog/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/blog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/blog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/blog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/blog/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/blog/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://tripplaninfo.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://evertqin.github.io/blog/2015/12/16/post28/';
          this.page.identifier = '2015/12/16/post28/';
          this.page.title = 'Making a Ajax file structure browser with ReactJs Flux Pattern';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://tripplaninfo.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  













  





  

  

  

  

  

  

</body>
</html>
